## Go ===============================================================================================================
#macro(list_item_base $index $value $separator)
#if( $index == 1 )${value}#else${separator}${value}#end
#end
#macro(list_item $index $value)
#list_item_base($index $value ", ")
#end
#macro(list_item_str $index $value)
#if( $index == 1 )"${value}"#else, "${value}"#end
#end
#macro(param_decls $external_sql $params)
#if ($external_sql == true)
sql string#if(${params.size()} > 0), #end
#end
#foreach($param in ${params})
#if(${velocityCount} > 1), #end${param.getLowerCamelCaseName()} ${param.getType()}#end
#end
#macro(param_decls_dto $external_sql)
#if($external_sql == true)sql string, #end
#end
#macro(sql_var $is_external_sql $sql)
#if (!${is_external_sql})
	sql := ${sql}
#end
#end
## ======================================================================================
#if ($mode=="dto_class")
package ${package}

// This code was generated by a tool. Don't modify it manually.
// Additional (hand-coded) methods can be implemented in a separate file like <this_file>_ex.go.
// http://sqldalmaker.sourceforge.net

#if (${imports.size()} > 0)
import (
#foreach($imp in ${imports})
	"${imp}"
#end
)

#end
type ${class_name} struct {
#foreach($f in ${fields})
	${f.getName()} ${f.getType()}
#end
}
## ======================================================================================
#elseif($mode=="dao_class")
package ${package}

// This code was generated by a tool. Don't modify it manually.
// Additional (hand-coded) methods can be implemented in a separate file like <this_file>_ex.go.
// http://sqldalmaker.sourceforge.net

#if (${imports.size()} == 1)
import "$imports[0]"

#elseif (${imports.size()} > 0)
import (
#foreach($imp in ${imports})
	"${imp}"
#end
)

#end
type ${class_name} struct {
	ds DataStore
}
#foreach($method in ${methods})${method}#end
## ======================================================================================
#elseif($mode=="dao_create")

// (C)RUD: ${table_name}
// Generated values are passed to DTO/model.

func (dao *${class_name}) ${method_name}(p *${dto_param}) (err error) {
#if($crud && $model != "")
	err = dao.ds.Create("${table_name}", p)
	return
}
#else
#sql_var(false $sql)
	res, err := dao.ds.Insert(sql, "${ai_names}"#foreach($param in ${params}), p.${param.getName()}#end)
	if err == nil {
#foreach ($ai in ${fields_ai})
		err = assign(&p.${ai.getName()}, res)
#end
	}
	return
}
#end
## ======================================================================================
#elseif($mode=="dao_query")

#if($crud)
// C(R)UD: ${ref}

#end
#if($fetch_list)
#if($use_dto)
#if(${dto_param} != "")
func (dao *${class_name}) ${method_name}(#param_decls_dto($is_external_sql)${dto_param} p) (res []*${returned_type_name}, err error) {
#else
func (dao *${class_name}) ${method_name}(#param_decls($is_external_sql $params)) (res []*${returned_type_name}, err error) {
#end
#if($crud && $model != "")
	err = dao.ds.ReadAll("${table_name}", &res)
	return
}
#else
#sql_var($is_external_sql $sql)
	errMap := make(map[string]int)
	onDto := func(row map[string]interface{}) {
		obj := ${returned_type_name}{}
#foreach($f in ${fields})
#set($i = ${velocityCount} - 1)
		fromRow(&obj.${f.getName()}, row, "${f.getColumnName()}", errMap)
#end
		res = append(res, &obj)
	}
#if(${dto_param} != "")
	err = dao.ds.QueryAllRows(sql, onDto#foreach($p in ${params}), p.${p.getName()}()#end)
#else
	err = dao.ds.QueryAllRows(sql, onDto#foreach($p in ${params}), ${p.getLowerCamelCaseName()}#end)
	if err == nil {
		err = errMapToErr(errMap)
	}
	return
}
#end
#end
#else
#if(${dto_param} != "")
func (dao *${class_name}) ${method_name}(#param_decls_dto($is_external_sql)${dto_param} p) (res []${returned_type_name}, err error) {
#else
func (dao *${class_name}) ${method_name}(#param_decls($is_external_sql $params)) (res []${returned_type_name}, err error) {
#end
#sql_var($is_external_sql $sql)
	errMap := make(map[string]int)
	onRow := func(val interface{}) {
		var data ${returned_type_name}
		fromVal(&data, val, errMap)
		res = append(res, data)
	}
#if(${dto_param} != "")
	err = dao.ds.QueryAll(sql, onRow#foreach($param in ${params}), p.${param.getName()}#end)
#else
	err = dao.ds.QueryAll(sql, onRow#foreach($param in ${params}), ${param.getLowerCamelCaseName()}#end)
#end
	if err == nil {
		err = errMapToErr(errMap)
	}
	return
}
#end
#else
#if(${dto_param} != "")
func (dao *${class_name}) ${method_name}(#param_decls_dto($is_external_sql)${dto_param} p) (res #if($use_dto)*#end${returned_type_name}, err error) {
#else
func (dao *${class_name}) ${method_name}(#param_decls($is_external_sql $params)) (res #if($use_dto)*#end${returned_type_name}, err error) {
#end
#if($crud && $model != "")
	res = &${returned_type_name}{}
	err = dao.ds.Read("${table_name}", res#foreach($param in ${params}), ${param.getLowerCamelCaseName()}#end)
	return
}
#else
#sql_var($is_external_sql $sql)
#if($use_dto)
#if(${dto_param} != "")
	row, err := dao.ds.QueryRow(sql#foreach($param in ${params}), p.${param.getName()}()#end))
#else
	row, err := dao.ds.QueryRow(sql#foreach($param in ${params}), ${param.getLowerCamelCaseName()})
#end
	if err != nil {
		return
	}
	res = &${returned_type_name}{}
	errMap := make(map[string]int)
#foreach($f in ${fields})
#set($i = ${velocityCount} - 1)
	fromRow(&res.${f.getName()}, row, "${f.getColumnName()}", errMap)
#end
	err = errMapToErr(errMap)
	return
#end
#else
#if(${dto_param} != "")
	r, err := dao.ds.Query(sql#foreach($p in ${params}), p.${p.getName()}()#end)
#else
	r, err := dao.ds.Query(sql#foreach($p in ${params}), ${p.getLowerCamelCaseName()}#end)
#end
	if err == nil {
		err = assign(&res, r)
	}
	return
#end
}
#end
#end
## ======================================================================================
#elseif($mode=="dao_exec_dml")

#if($method_type == "CREATE")
// (C)RUD: ${table_name}

#elseif($method_type == "UPDATE")
// CR(U)D: ${table_name}

#elseif($method_type == "DELETE")
// CRU(D): ${table_name}

#end
#if(${dto_param} != "")
func (dao *${class_name}) ${method_name}(#param_decls_dto($is_external_sql)p *${dto_param}) (rowsAffected int64, err error) {
#if($crud && $model != "")
#if ($method_type == "CREATE" || $method_type == "UPDATE")
	rowsAffected, err = dao.ds.Update("${table_name}", p)
#else
	rowsAffected, err = dao.ds.Delete("${table_name}", p)
#end
#else
#sql_var($is_external_sql $sql)
	rowsAffected, err = dao.ds.Exec(sql#foreach($param in ${params}), p.${param.getName()}#end)
#end
	return
}
#else
func (dao *${class_name}) ${method_name}(#param_decls($is_external_sql $params)) (rowsAffected int64, err error) {
#sql_var($is_external_sql $sql)
#if($mappings.size()>0)
	errMap := make(map[string]int)
#end
#foreach($m in $mappings)
	${m.get_exec_dml_param_name()} := func(rd map[string]interface{}) {
		obj := ${m.get_dto_class_name()}{}
#foreach($f in ${m.get_fields()})
		fromRow(&obj.${f.getName()}, rd, "${f.getColumnName()}", errMap)
#end
		${m.get_method_param_name()}(&obj)
	}
#end
#if ($method_type == "CREATE" || $method_type == "UPDATE" || $method_type == "DELETE")
	rowsAffected, err = dao.ds.Exec(sql#foreach($param in ${params}), ${param.getLowerCamelCaseName()}#end)
#else
	rowsAffected, err = dao.ds.Exec(sql#foreach($param in ${params2}), ${param.getLowerCamelCaseName()}#end)
#end
#if($mappings.size()>0)
	if err == nil {
		err = errMapToErr(errMap)
	}
#end
	return
}
#end
#end